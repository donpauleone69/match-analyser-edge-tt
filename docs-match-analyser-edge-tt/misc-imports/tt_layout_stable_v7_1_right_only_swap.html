<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TT Rally Tagger — STABLE v7.1 (Right-only, Swap Serve/Shot)</title>
<style>
  :root{
    --bg:#0f1115; --panel:#151a24; --panel2:#1b2230; --ink:#e6e9ef; --muted:#9aa4b2;
    --border:#30384a; --accent:#6aa6ff; --ok:#2ecc71; --danger:#ff6b6b; --active:#ffe082;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:13px/1.42 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
  .wrap{display:grid;grid-template-columns:1fr;gap:10px;padding:12px}
  .panel{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:12px}
  .topbar{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:10px;margin-bottom:8px}
  .nameSide{display:flex;align-items:center;gap:6px;justify-content:flex-start}
  .nameSide.right{justify-content:flex-end}
  input.player{background:var(--panel2);border:1px solid var(--border);color:var(--ink);border-radius:8px;padding:6px 8px;width:200px;text-align:center}
  .nameBtn{background:var(--panel2);border:1px solid var(--border);color:var(--ink);border-radius:8px;padding:4px 8px;cursor:pointer; font-size:12px}
  .nameBtn.active{border-color:var(--accent); box-shadow:0 0 0 1px var(--accent) inset}
  .score{font-size:20px;font-weight:800;padding:4px 12px;border:1px solid var(--border);border-radius:10px;background:var(--panel2);display:flex;align-items:center;gap:10px}
  .activeName{outline:2px solid var(--active); border-radius:8px}
  .serverRow{display:flex;justify-content:space-between;gap:8px;margin-bottom:8px}
  .serverTag{font-size:11px;padding:2px 6px;border-radius:999px;border:1px solid var(--border);background:rgba(122,166,255,.15)}
  h2{font-size:14px;margin:8px 0 6px}
  .group{margin:6px 0}
  .label{color:var(--muted); font-size:11px; margin-bottom:4px}
  .btnrow{display:flex; gap:6px; flex-wrap:wrap; align-items:center}
  .chip{background:var(--panel2); border:1px solid var(--border); color:var(--ink); padding:6px 8px; border-radius:8px; cursor:pointer; font-size:12px}
  .chip.active{border-color:var(--ok); box-shadow:0 0 0 1px var(--ok) inset; background:rgba(46,204,113,.12)}
  .chip.red{border-color:var(--danger); color:#fff; background:rgba(255,107,107,.22)}
  .chip.red.active{box-shadow:0 0 0 1px var(--danger) inset}
  .btn{background:var(--panel2); border:1px solid var(--border); color:var(--ink); padding:6px 8px; border-radius:8px; cursor:pointer; font-size:12px}
  .btn.confirm{border-color:var(--ok); box-shadow:0 0 0 1px var(--ok) inset}
  .btn.reset{border-color:var(--danger); box-shadow:0 0 0 1px var(--danger) inset}
  .grid2{display:grid; grid-template-columns:1fr 1fr; gap:8px}
  .footer{display:flex; gap:10px; justify-content:flex-end; align-items:flex-start; margin-top:8px}
  .preview{font-weight:700; color:#ffd166; width:40%; text-align:right}
  .log{background:var(--panel2); border:1px solid var(--border); border-radius:10px; padding:8px; max-height:220px; overflow:auto; width:60%}
  .log h3{margin:0 0 6px; font-size:13px}
  .log ol{margin:0; padding-left:18px}
  .muted{color:#9aa4b2}
</style>
</head>
<body>
<div class="wrap">
  <div class="panel">
    <div class="topbar">
      <div class="nameSide" id="topBlock">
        <button class="nameBtn" id="btnP2Serve">Serve First</button>
        <input class="player" id="pl2" placeholder="Player 2 (Top)">
      </div>
      <div class="score" id="scoreText">
        <span id="p1NameScore">P1</span>
        <span id="scoreDash">0 — 0</span>
        <span id="p2NameScore">P2</span>
      </div>
      <div class="nameSide right" id="botBlock">
        <input class="player" id="pl1" placeholder="Player 1 (Bottom)">
        <button class="nameBtn" id="btnP1Serve">Serve First</button>
      </div>
    </div>
    <div class="serverRow">
      <span class="serverTag" id="serverTag">Server: —</span>
      <span class="serverTag" id="serveCount">Serves left: 2</span>
    </div>

    <div class="section" id="serveSection">
      <h2>Serve</h2>
      <div class="group">
        <div class="label">Serve Type</div>
        <div class="btnrow" data-group="serveType">
          <button class="chip">Pendulum</button>
          <button class="chip">Backhand</button>
          <button class="chip">Tomahawk</button>
          <button class="chip">Hook</button>
          <button class="chip">Other</button>
        </div>
      </div>

      <div class="grid2">
        <div class="group">
          <div class="label">Start/Contact (BH · M · FH)</div>
          <div class="btnrow" data-group="serveStart">
            <button class="chip">BH</button>
            <button class="chip">M</button>
            <button class="chip">FH</button>
          </div>
        </div>
        <div class="group">
          <div class="label">Spin (combined)</div>
          <div class="btnrow" data-group="serveSpinCombo">
            <button class="chip" data-kind="nos">No Spin</button>
            <button class="chip" data-kind="u">Under</button>
            <button class="chip" data-kind="t">Top</button>
            <button class="chip" data-kind="l">Left</button>
            <button class="chip" data-kind="r">Right</button>
          </div>
        </div>
      </div>

      <div class="grid2">
        <div class="group">
          <div class="label">Target (BH · M · FH)</div>
          <div class="btnrow" data-group="serveTarget">
            <button class="chip">BH</button>
            <button class="chip">M</button>
            <button class="chip">FH</button>
          </div>
        </div>
        <div class="group">
          <div class="label">Length</div>
          <div class="btnrow" data-group="serveLength">
            <button class="chip red" data-val="NET">IN THE NET</button>
            <button class="chip" data-val="S">S</button>
            <button class="chip" data-val="HL">HL</button>
            <button class="chip" data-val="L">L</button>
            <button class="chip red" data-val="LONG">MISSED LONG</button>
          </div>
          <div class="muted">Serve errors are always recorded as <strong>Unforced</strong>.</div>
        </div>
      </div>

      <div class="grid2">
        <div class="group">
          <div class="label">Speed</div>
          <div class="btnrow" data-group="serveSpeed">
            <button class="chip">Slow</button>
            <button class="chip">Medium</button>
            <button class="chip">Fast</button>
          </div>
        </div>
      </div>

      <div class="btnrow">
        <button class="btn reset" id="btnClearServe">Clear</button>
        <button class="btn confirm" id="btnConfirmServe">Confirm Serve</button>
      </div>
    </div>

    <div class="section" id="shotSection" style="display:none">
      <h2>Shot</h2>

      <div class="group">
        <div class="label">Stroke Type</div>
        <div class="btnrow" data-group="strokeSide">
          <button class="chip">Forehand</button>
          <button class="chip">Backhand</button>
        </div>
        <div class="btnrow" data-group="strokeType">
          <button class="chip">Push</button>
          <button class="chip">Flick</button>
          <button class="chip">Loop</button>
          <button class="chip">Block</button>
          <button class="chip">Drive</button>
          <button class="chip">Smash</button>
          <button class="chip">Lob</button>
        </div>
        <div class="btnrow">
          <button class="chip" id="winnerToggle">Winner (toggle)</button>
        </div>
      </div>

      <div class="grid2">
        <div class="group">
          <div class="label">Target (BH · M · FH)</div>
          <div class="btnrow" data-group="target">
            <button class="chip">BH</button>
            <button class="chip">M</button>
            <button class="chip">FH</button>
          </div>
        </div>
        <div class="group">
          <div class="label">Length</div>
          <div class="btnrow" data-group="length">
            <button class="chip red" data-val="NET">IN THE NET</button>
            <button class="chip" data-val="S">S</button>
            <button class="chip" data-val="M">M</button>
            <button class="chip" data-val="L">L</button>
            <button class="chip red" data-val="LONG">MISSED LONG</button>
          </div>
          <div class="btnrow" id="classifyRow">
            <button class="chip" id="btnUFE" disabled>Unforced Error</button>
            <button class="chip" id="btnFE" disabled>Forced Error</button>
          </div>
        </div>
      </div>

      <div class="grid2">
        <div class="group">
          <div class="label">Spin (combined)</div>
          <div class="btnrow" data-group="spinCombo">
            <button class="chip" data-kind="nos">No Spin</button>
            <button class="chip" data-kind="u">Under</button>
            <button class="chip" data-kind="t">Top</button>
            <button class="chip" data-kind="l">Left</button>
            <button class="chip" data-kind="r">Right</button>
          </div>
        </div>
        <div class="group">
          <div class="label">Speed</div>
          <div class="btnrow" data-group="speed">
            <button class="chip">S</button>
            <button class="chip">M</button>
            <button class="chip">F</button>
          </div>
        </div>
      </div>

      <div class="btnrow">
        <button class="btn reset" id="btnClearShot">Clear</button>
        <button class="btn confirm" id="btnConfirmShot">Confirm Shot</button>
      </div>
    </div>

    <div class="footer">
      <div class="preview" id="livePreview">Current: —</div>
      <div class="log">
        <h3>Rally Log</h3>
        <ol id="logList"></ol>
      </div>
    </div>
    <div style="display:flex; gap:8px; justify-content:flex-end">
      <button class="btn" id="btnResetRally">Reset Rally</button>
    </div>
  </div>
</div>

<script>
(function(){
  const S = {
    stage: 'serve_contact',
    server: 'P1',
    servesLeft: 2,
    score: { P1:0, P2:0 },
    lastLanding: null,
    shots: [],
    pick: {
      serveType:null, serveSpin:null, serveSideSpin:null, serveSpeed:null, serveStart:null, serveTarget:null, serveLength:null,
      strokeType:null, strokeSide:null, target:null, length:null, spin:null, sideSpin:null, speed:null, winner:false,
      classify:null
    }
  };

  const $ = (sel, root=document)=> root.querySelector(sel);
  const $$ = (sel, root=document)=> Array.from(root.querySelectorAll(sel));

  wireUI();
  setServer('P1'); updateUI(); updateLive(); swapSections();

  function wireUI(){
    $('#btnP1Serve').addEventListener('click', ()=> setServer('P1'));
    $('#btnP2Serve').addEventListener('click', ()=> setServer('P2'));

    $('#winnerToggle').addEventListener('click', (e)=>{ S.pick.winner = !S.pick.winner; e.target.classList.toggle('active', S.pick.winner); updateLive(); });

    $('#btnUFE').addEventListener('click', ()=> { S.pick.classify='UFE'; refreshClassify(); updateLive(); });
    $('#btnFE').addEventListener('click', ()=> { S.pick.classify='FE'; refreshClassify(); updateLive(); });

    $$('[data-group]').forEach(group => {
      group.addEventListener('click', (e)=>{
        const btn = e.target.closest('.chip'); if(!btn) return;
        const key = group.getAttribute('data-group');

        if(key==='spinCombo' || key==='serveSpinCombo'){
          handleSpinCombo(group, btn, key==='serveSpinCombo');
          updateLive(); return;
        }
        if(key==='length'){
          $$('.chip', group).forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          const val = btn.getAttribute('data-val') || btn.textContent.trim();
          S.pick.length = val;
          if(val==='NET' || val==='LONG'){ enableClassify(true); } else { S.pick.classify=null; enableClassify(false); }
          updateLive(); return;
        }
        if(key==='serveLength'){
          $$('.chip', group).forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          const val = btn.getAttribute('data-val') || btn.textContent.trim();
          S.pick.serveLength = val; updateLive(); return;
        }

        $$('.chip', group).forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const map = {
          serveType:'serveType', serveSpeed:'serveSpeed', serveStart:'serveStart',
          serveTarget:'serveTarget',
          target:'target', speed:'speed', strokeType:'strokeType', strokeSide:'strokeSide'
        };
        const value = btn.getAttribute('data-val') || btn.textContent.trim();
        S.pick[map[key]||key] = value;
        updateLive();
      });
    });

    $('#btnConfirmServe').addEventListener('click', confirmServe);
    $('#btnConfirmShot').addEventListener('click', confirmShot);
    $('#btnClearServe').addEventListener('click', ()=>{ clearServePick(); updateLive(); });
    $('#btnClearShot').addEventListener('click', ()=>{ clearShotPick(); updateLive(); });
    $('#btnResetRally').addEventListener('click', ()=>{ resetRally(); updateUI(); updateLive(); swapSections(); });
  }

  function handleSpinCombo(group, btn, isServe){
    const chips = $$('.chip', group);
    const kind = btn.getAttribute('data-kind');
    if(kind==='nos'){
      chips.forEach(c=> c.classList.remove('active'));
      btn.classList.add('active');
      if(isServe){ S.pick.serveSpin='N'; S.pick.serveSideSpin='0'; }
      else { S.pick.spin='N'; S.pick.sideSpin='0'; }
      return;
    }
    btn.classList.toggle('active');
    const activeKinds = new Set($$('.chip.active', group).map(c=> c.getAttribute('data-kind')));
    if(activeKinds.size>0 && activeKinds.has('nos')){
      const nosBtn = $('.chip[data-kind="nos"]', group);
      nosBtn && nosBtn.classList.remove('active');
      activeKinds.delete('nos');
    }
    if(activeKinds.has('u') && activeKinds.has('t')){
      chips.forEach(c=>{ const k=c.getAttribute('data-kind'); if(k==='u' || k==='t'){ if(k!==kind) c.classList.remove('active'); } });
      activeKinds.clear(); activeKinds.add(kind);
    }
    if(activeKinds.has('l') && activeKinds.has('r')){
      chips.forEach(c=>{ const k=c.getAttribute('data-kind'); if(k==='l' || k==='r'){ if(k!==kind) c.classList.remove('active'); } });
      activeKinds.clear(); activeKinds.add(kind);
    }
    const spinVal = activeKinds.has('u') ? 'U' : activeKinds.has('t') ? 'T' : (activeKinds.size===0 ? null : 'N');
    const sideVal = activeKinds.has('l') ? 'L' : activeKinds.has('r') ? 'R' : (activeKinds.has('nos') ? '0' : null);
    if(isServe){
      if(spinVal) S.pick.serveSpin = spinVal;
      if(sideVal!==null) S.pick.serveSideSpin = sideVal;
      if(activeKinds.size===0){ S.pick.serveSpin=null; S.pick.serveSideSpin=null; }
    }else{
      if(spinVal) S.pick.spin = spinVal;
      if(sideVal!==null) S.pick.sideSpin = sideVal;
      if(activeKinds.size===0){ S.pick.spin=null; S.pick.sideSpin=null; }
    }
  }

  function setServer(who){
    S.server = who; S.servesLeft = 2; S.stage = 'serve_contact';
    resetRally(); updateUI(); swapSections();
  }
  function currentHitter(){
    if(S.stage==='serve_contact') return S.server;
    if(!S.lastLanding) return S.server;
    return (S.lastLanding.half==='top') ? 'P2' : 'P1';
  }
  function currentHitterName(){ return currentHitter()==='P1' ? (plName('#pl1')||'Player 1') : (plName('#pl2')||'Player 2'); }
  function plName(id){ return $(id).value || (id==='#pl1'?'Player 1':'Player 2'); }

  function updateUI(){
    $('#serverTag').textContent = 'Server: ' + (S.server==='P1'? plName('#pl1'): plName('#pl2'));
    $('#serveCount').textContent = 'Serves left: ' + S.servesLeft;
    $('#scoreDash').textContent = `${S.score.P1} — ${S.score.P2}`;
    $('#p1NameScore').textContent = plName('#pl1')||'Player 1';
    $('#p2NameScore').textContent = plName('#pl2')||'Player 2';
    $('#p1NameScore').classList.toggle('activeName', currentHitter()==='P1');
    $('#p2NameScore').classList.toggle('activeName', currentHitter()==='P2');
    $('#btnP1Serve').classList.toggle('active', S.server==='P1');
    $('#btnP2Serve').classList.toggle('active', S.server==='P2');
  }
  function swapSections(){
    const serveOn = (S.stage==='serve_contact');
    $('#serveSection').style.display = serveOn ? '' : 'none';
    $('#shotSection').style.display  = serveOn ? 'none' : '';
  }

  function updateLive(){
    if(S.stage==='serve_contact'){
      const s = S.pick;
      const len = s.serveLength||'?';
      const err = (len==='NET'||len==='LONG') ? ' · UFE' : '';
      setLive(`${currentHitterName()} Serve: ${s.serveType||'?'} | Spin:${s.serveSpin||'?'} / ${s.serveSideSpin||'?'} | Spd:${s.serveSpeed||'?'} | Start:${s.serveStart||'?'} → ${(len==='NET'||len==='LONG')?len:(s.serveTarget||'?')+'-'+len}${err}`);
    } else {
      const s = S.pick;
      const len = s.length||'?';
      const err = (len==='NET'||len==='LONG') ? ` · ${s.classify||'—'}` : '';
      setLive(`${currentHitterName()} ${s.strokeSide||'?'} ${s.strokeType||'?'} | → ${(len==='NET'||len==='LONG')?len:(s.target||'?')+'-'+len} | Spin:${s.spin||'?'} / ${s.sideSpin||'?'} | Spd:${s.speed||'?'}${err}${s.winner?' · WINNER':''}`);
    }
  }
  function setLive(t){ $('#livePreview').textContent = 'Current: ' + t; }

  function confirmServe(){
    const s = S.pick;
    if(!s.serveStart || !s.serveLength) return;

    if(s.serveLength==='NET' || s.serveLength==='LONG'){
      const finalServe = {
        type:'Serve', player: currentHitter(),
        serveType:s.serveType, spin:s.serveSpin, sideSpin:s.serveSideSpin, speed:s.serveSpeed,
        startSide:s.serveStart, target:s.serveTarget||'—', length:s.serveLength,
        outcome:{kind:(s.serveLength==='NET'?'net':'long'), class:'UFE'}
      };
      const winner = (currentHitter()==='P1') ? 'P2' : 'P1';
      S.score[winner] += 1; addToLog(finalServe, winner);
      rotateServeIfNeeded(); resetRally(); updateUI(); updateLive(); swapSections(); return;
    }

    if(!s.serveTarget) return;
    const shot = {
      type:'Serve', player: currentHitter(),
      serveType:s.serveType, spin:s.serveSpin, sideSpin:s.serveSideSpin, speed:s.serveSpeed,
      startSide:s.serveStart, target:s.serveTarget, length:s.serveLength
    };
    S.shots.push(shot); addToLog(shot);
    S.lastLanding = { half: (S.server==='P1'?'top':'bottom'), col: s.serveTarget };
    S.stage='rally_target'; clearServePick(); updateUI(); updateLive(); swapSections();
  }

  function confirmShot(){
    const s = S.pick;
    if(!s.strokeSide || !s.strokeType) return;

    if(s.winner && s.length!=='NET' && s.length!=='LONG'){
      const final = {
        type:'Stroke', player: currentHitter(),
        strokeSide:s.strokeSide, strokeType:s.strokeType,
        startSide:autoStartCol()||'?', target:s.target||'?', length:s.length||'?',
        spin:s.spin, sideSpin:s.sideSpin, speed:s.speed, outcome:{kind:'in', class:'WIN'}
      };
      const winner = currentHitter();
      S.score[winner]+=1; addToLog(final, winner);
      rotateServeIfNeeded(); resetRally(); updateUI(); updateLive(); swapSections(); return;
    }

    if(s.length==='NET' || s.length==='LONG'){
      if(!s.classify) return;
      const hitter = currentHitter();
      const final = {
        type:'Stroke', player: hitter,
        strokeSide:s.strokeSide, strokeType:s.strokeType,
        startSide:autoStartCol()||'?', target:s.target||'—', length:s.length,
        spin:s.spin, sideSpin:s.sideSpin, speed:s.speed, outcome:{kind:(s.length==='NET'?'net':'long'), class:s.classify}
      };
      const winner = hitter==='P1' ? 'P2' : 'P1';
      S.score[winner]+=1; addToLog(final, winner);
      rotateServeIfNeeded(); resetRally(); updateUI(); updateLive(); swapSections(); return;
    }

    if(!s.target || !s.length) return;
    const shot = {
      type:'Stroke', player: currentHitter(),
      strokeSide:s.strokeSide, strokeType:s.strokeType,
      startSide:autoStartCol()||'?', target:s.target, length:s.length,
      spin:s.spin, sideSpin:s.sideSpin, speed:s.speed
    };
    S.shots.push(shot); addToLog(shot);
    const hitterHalf = currentHitter()==='P1' ? 'bottom' : 'top';
    const landingHalf = (hitterHalf==='top') ? 'bottom' : 'top';
    S.lastLanding = {half: landingHalf, col: s.target};
    clearShotPick(); updateUI(); updateLive();
  }

  function autoStartCol(){ return S.lastLanding ? S.lastLanding.col : null; }
  function rotateServeIfNeeded(){
    S.servesLeft -= 1;
    if(S.servesLeft<=0){ S.server = (S.server==='P1'?'P2':'P1'); S.servesLeft = 2; }
  }
  function resetRally(){
    S.stage='serve_contact'; S.shots=[]; S.lastLanding=null;
    clearServePick(); clearShotPick(); enableClassify(false);
  }
  function clearServePick(){
    S.pick.serveType=S.pick.serveSpin=S.pick.serveSideSpin=S.pick.serveSpeed=S.pick.serveStart=S.pick.serveTarget=S.pick.serveLength=null;
    clearGroup('serveType'); clearGroup('serveSpinCombo'); clearGroup('serveSpeed'); clearGroup('serveStart'); clearGroup('serveTarget'); clearGroup('serveLength');
  }
  function clearShotPick(){
    S.pick.strokeType=S.pick.strokeSide=S.pick.target=S.pick.length=S.pick.spin=S.pick.sideSpin=S.pick.speed=null;
    S.pick.winner=false; S.pick.classify=null;
    clearGroup('strokeType'); clearGroup('strokeSide'); clearGroup('spinCombo'); clearGroup('target'); clearGroup('length'); clearGroup('speed');
    const wt = document.getElementById('winnerToggle'); wt && wt.classList.remove('active'); enableClassify(false);
  }
  function clearGroup(key){
    const g = document.querySelector('[data-group="'+key+'"]'); if(!g) return;
    $$('.chip', g).forEach(b=> b.classList.remove('active'));
  }
  function enableClassify(on){
    const u = document.getElementById('btnUFE'), f = document.getElementById('btnFE');
    if(!u || !f) return;
    u.disabled = !on; f.disabled = !on;
    if(!on){ u.classList.remove('active'); f.classList.remove('active'); }
  }
  function refreshClassify(){
    const u = document.getElementById('btnUFE'), f = document.getElementById('btnFE');
    if(!u || !f) return;
    u.classList.toggle('active', S.pick.classify==='UFE');
    f.classList.toggle('active', S.pick.classify==='FE');
  }

  function addToLog(shot, winnerIfAny){
    const list = document.getElementById('logList'); const li = document.createElement('li');
    const nameP = (p)=> p==='P1' ? (plName('#pl1')||'Player 1') : (plName('#pl2')||'Player 2');
    if(shot.type==='Serve'){
      const base = `${nameP(shot.player)} Serve: ${shot.serveType||'?'} | Spin:${shot.spin||'?'} / ${shot.sideSpin||'?'} | Spd:${shot.speed||'?'} | Start:${shot.startSide||'?'} → ${(shot.length==='NET'||shot.length==='LONG')?shot.length:(shot.target||'?')+'-'+(shot.length||'?')}`;
      if(shot.outcome){
        const winName = winnerIfAny ? nameP(winnerIfAny) : '—';
        li.textContent = `${base} · Outcome: ${shot.outcome.kind.toUpperCase()} · Unforced → point to ${winName} | Score ${S.score.P1}–${S.score.P2}`;
      } else { li.textContent = base; }
    } else {
      const base = `${nameP(shot.player)} ${shot.strokeSide||'?'} ${shot.strokeType||'?'} | Start:${shot.startSide||'?'} → ${(shot.length==='NET'||shot.length==='LONG')?shot.length:(shot.target||'?')+'-'+(shot.length||'?')} | Spin:${shot.spin||'?'} / ${shot.sideSpin||'?'} | Spd:${shot.speed||'?'}`;
      if(shot.outcome){
        const nameCls = {'UFE':'Unforced', 'FE':'Forced', 'WIN':'Winner'}[shot.outcome.class] || '';
        const winName = winnerIfAny ? nameP(winnerIfAny) : '—';
        li.textContent = `${base} · Outcome: ${(shot.outcome.kind==='in'?'':shot.outcome.kind.toUpperCase()+' · ')}${nameCls} → point to ${winName} | Score ${S.score.P1}–${S.score.P2}`;
      } else { li.textContent = base; }
    }
    list.appendChild(li);
    const logBox = list.parentElement; logBox.scrollTop = logBox.scrollHeight;
  }
})();</script>
</body>
</html>
